<script lang="ts">
    import { onDestroy, onMount, type Component, type Snippet } from 'svelte';

    import Auth from '../(assets)/icons/auth.svg';
    import Databases from '../(assets)/icons/databases.svg';
    import Functions from '../(assets)/icons/functions.svg';
    import Storage from '../(assets)/icons/storage.svg';
    import Realtime from '../(assets)/icons/realtime.svg';
    import Messaging from '../(assets)/icons/messaging.svg';
    import { classNames } from '$lib/utils/classnames';

    import AuthSlide from '../(assets)/slides/auth.svg';
    import DatabasesSlide from '../(assets)/slides/databases.svg';
    import FunctionsSlide from '../(assets)/slides/functions.svg';
    import StorageSlide from '../(assets)/slides/storage.svg';
    import RealtimeSlide from '../(assets)/slides/realtime.svg';
    import MessagingSlide from '../(assets)/slides/messaging.svg';
    import type { SvelteHTMLElements } from 'svelte/elements';

    const products: Array<{
        label: string;
        icon: string;
        line: (isActive: boolean) => string;
        image: string;
    }> = [
        {
            label: 'Auth',
            icon: Auth,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="75" viewBox="0 0 98 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 1H35.3623C41.9897 1 47.3623 6.37258 47.3623 13V62C47.3623 68.6274 52.7349 74 59.3623 74H98" class="group-hover:stroke-white ${isActive && 'stroke-white'} group-focus-within:stroke-white transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: AuthSlide
        },
        {
            label: 'Databases',
            icon: Databases,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="2" viewBox="0 0 98 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 1L98 1.00001" class="group-hover:stroke-white group-focus-within:stroke-white ${isActive && 'stroke-white'}  transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: DatabasesSlide
        },
        {
            label: 'Functions',
            icon: Functions,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="75" viewBox="0 0 98 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 74H35.3623C41.9897 74 47.3623 68.6274 47.3623 62V13C47.3623 6.37258 52.7349 0.999998 59.3623 0.999998H98" class="group-hover:stroke-white ${isActive && 'stroke-white'} group-focus-within:stroke-white transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: FunctionsSlide
        },
        {
            label: 'Storage',
            icon: Storage,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="75" viewBox="0 0 98 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M98 1H62.6377C56.0103 1 50.6377 6.37258 50.6377 13V62C50.6377 68.6274 45.2651 74 38.6377 74H-9.53674e-07" class="group-hover:stroke-white ${isActive && 'stroke-white'} group-focus-within:stroke-white transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: StorageSlide
        },
        {
            label: 'Realtime',
            icon: Realtime,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="2" viewBox="0 0 98 2" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 1L98 1.00001" class="group-hover:stroke-white group-focus-within:stroke-white ${isActive && 'stroke-white'} transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: RealtimeSlide
        },
        {
            label: 'Messaging',
            icon: Messaging,
            line: (
                isActive: boolean
            ) => `<svg width="98" height="75" viewBox="0 0 98 75" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M98 74H62.6377C56.0103 74 50.6377 68.6274 50.6377 62V13C50.6377 6.37258 45.2651 0.999998 38.6377 0.999998H-9.53674e-07" class="group-hover:stroke-white ${isActive && 'stroke-white'} group-focus-within:stroke-white transition stroke-smooth" stroke-dasharray="4 4"/>
                   </svg>`,
            image: MessagingSlide
        }
    ];

    let activeIndex = $state(0);
    let paused = $state<boolean>(false);

    const autoCycle = () => {
        if (paused) return;
        activeIndex = (activeIndex + 1) % products.length;
    };

    let interval = $state<NodeJS.Timeout>();

    const handleSetActive = (index: number) => {
        paused = true;
        activeIndex = index;
    };

    const handleMouseOut = () => {
        paused = false;
    };

    $effect(() => {
        interval = setInterval(autoCycle, 5000);

        return () => {
            clearInterval(interval);
        };
    });
</script>

<div class="my-40 flex flex-col gap-16 bg-center">
    <div
        class="relative grid grid-cols-12 place-items-center [background:_radial-gradient(50%_50%_at_50%_50%,_rgba(253,_54,_110,_0.1)_0%,_rgba(253,_54,_110,_0)_100%)]"
    >
        <div class="col-span-3 w-full">
            <div class="text-body flex flex-col items-end gap-12 font-medium text-white">
                {#each products.slice(0, 3) as product, index}
                    <div class="group relative mr-auto ml-0 flex w-full items-center">
                        <button
                            class="bg-card border-smooth mr-[100px] ml-auto flex cursor-pointer items-center gap-2 rounded-xl border py-2 pr-4 pl-3 backdrop-blur-md"
                            onmouseover={() => handleSetActive(index)}
                            onfocus={() => handleSetActive(index)}
                            onmouseout={() => handleMouseOut()}
                            onblur={() => handleMouseOut()}
                        >
                            <img src={product.icon} alt={product.label} class="h-6 w-6" />
                            {product.label}
                        </button>
                        <div
                            class={classNames('absolute right-0', {
                                'top-1/2': index === 0,
                                'bottom-1/2': index === 2
                            })}
                        >
                            {@html product.line(activeIndex === index)}
                        </div>
                    </div>
                {/each}
            </div>
        </div>
        <div
            class="window col-span-6 flex aspect-[6.5/4.5] w-full items-center justify-center rounded-[48px] border border-dashed border-transparent p-3"
            style:animation-delay="0.6s"
        >
            <div
                class="window flex h-full flex-1 rounded-[40px] border border-dashed border-transparent p-3"
                style:animation-delay="0.4s"
            >
                <div
                    class="window flex h-full flex-1 rounded-[28px] border border-dashed border-transparent p-3"
                    style:animation-delay="0.2s"
                >
                    <div
                        class="bg-greyscale-850 border-smooth flex flex-1 flex-col rounded-[20px] border px-2 pb-2"
                    >
                        <div class="flex h-8 w-fit items-center justify-start gap-1.5 pl-2">
                            {#each Array.from({ length: 3 }) as _}
                                <div
                                    class="size-2 flex-1 shrink cursor-pointer rounded-full bg-[#D9D9D9] transition hover:opacity-75"
                                ></div>
                            {/each}
                        </div>
                        <div class="relative flex-1 overflow-hidden rounded-2xl bg-[#19191C]">
                            {#each products as product, i}
                                <img
                                    src={product.image}
                                    class={classNames(
                                        'absolute inset-0 h-full w-full rounded-2xl transition-all duration-500',
                                        'scale-102 opacity-0 blur-md',
                                        {
                                            'scale-100 opacity-100 blur-none': i === activeIndex,
                                            invisible: i !== activeIndex
                                        }
                                    )}
                                    aria-hidden={i !== activeIndex}
                                    alt=""
                                />
                            {/each}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-span-3 w-full">
            <div class="text-body flex flex-col gap-12 font-medium text-white">
                {#each products.slice(3) as product, i}
                    {@const index = i + 3}
                    <div class="group relative mr-0 ml-auto flex w-full items-center">
                        <button
                            class="bg-card border-smooth mr-auto ml-[100px] flex cursor-pointer items-center gap-2 rounded-xl border py-2 pr-4 pl-3 backdrop-blur-md"
                            onmouseover={() => handleSetActive(index)}
                            onfocus={() => handleSetActive(index)}
                            onmouseout={() => handleMouseOut()}
                            onblur={() => handleMouseOut()}
                        >
                            <img src={product.icon} alt={product.label} class="h-6 w-6" />
                            {product.label}
                        </button>
                        <div
                            class={classNames('absolute left-0', {
                                'top-1/2': i === 0,
                                'bottom-1/2': i === 2
                            })}
                        >
                            {@html product.line(activeIndex === index)}
                        </div>
                    </div>
                {/each}
            </div>
        </div>
    </div>
    <div class="mx-auto flex flex-col gap-2 text-center">
        <h2 class="text-primary text-title font-aeonik-pro">Integrate your backend</h2>
        <p class="text-secondary mx-auto">
            Integrate your frontend easily with our backend products:<br /> Auth, Databases, Functions,
            Messaging, Storage and Realtime.
        </p>
    </div>
</div>

<style>
    .window {
        --border-color: var(--color-pink-hue), 65%, 48%;
        animation: border-pulse 2.5s infinite ease-in-out;
    }

    @keyframes border-pulse {
        0% {
            border-color: hsla(var(--border-color), 1);
        }
        25% {
            border-color: hsla(var(--border-color), 0.5);
        }
        50% {
            border-color: hsla(var(--border-color), 0);
        }
        75% {
            border-color: hsla(var(--border-color), 0.5);
        }
        100% {
            border-color: hsla(var(--border-color), 1);
        }
    }
</style>
